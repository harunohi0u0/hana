<!DOCTYPE html>
<html lang="ko" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>매매일지 & 가계부</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            transition: background-color 0.3s ease;
        }
        .tab-btn { transition: all 0.3s ease; }
        .tab-btn.active { background-color: #4a90e2; color: white; font-weight: 700; }
        .tag { transition: all 0.2s ease; cursor: pointer; }
        .tag.selected { background-color: #4a90e2; color: white; }
        .modal-backdrop { background-color: rgba(0,0,0,0.5); transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }
        
        .toggle-group {
            display: flex;
            border-radius: 0.75rem;
            padding: 0.25rem;
            background-color: #e5e7eb; /* bg-gray-200 */
        }

        .toggle-btn {
            flex: 1;
            padding: 0.5rem 0;
            border-radius: 0.5rem;
            border: none;
            background-color: transparent;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .toggle-btn.selected {
            background-color: white;
            color: #3b82f6; /* text-blue-600 */
            font-weight: 700;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .tag.selected .delete-tag-span {
            color: white;
        }
        .tag.selected .delete-tag-span:hover {
            color: #fecaca; /* light red */
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        /* --- GUARANTEED DARK MODE STYLES --- */
        .dark body {
            background-color: #000;
            color: #d4d4d8; /* zinc-300 */
        }
        .dark h1, .dark h2, .dark h3, .dark h4, .dark h5 {
            color: #f4f4f5; /* zinc-100 */
        }
        .dark p, .dark label, .dark span, .dark strong, .dark select {
            color: #d4d4d8; /* zinc-300 */
        }
        .dark header p, .dark .text-gray-500 {
            color: #a1a1aa; /* zinc-400 */
        }
        .dark #auth-info {
            color: #71717a; /* zinc-500 */
        }
        .dark #theme-toggle:hover, .dark #logout-btn:hover {
            background-color: #27272a; /* zinc-800 */
        }
        .dark nav, .dark form, .dark #list-view > div:first-child, .dark #stats-view > div:first-child, .dark .bg-white {
            background-color: #18181b; /* zinc-900 */
        }
        .dark .tab-btn {
             color: #d4d4d8; /* zinc-300 */
        }
        .dark input, .dark select, .dark .toggle-group {
            background-color: #27272a; /* zinc-800 */
            border-color: #3f3f46; /* zinc-700 */
            color: #e4e4e7; /* zinc-200 */
        }
         .dark input::placeholder {
            color: #71717a; /* zinc-500 */
        }
        .dark .toggle-btn {
            color: #d4d4d8; /* zinc-300 */
        }
        .dark .toggle-btn.selected {
            background-color: #3f3f46; /* zinc-700 */
            color: #60a5fa; /* blue-400 */
        }
        .dark .tag.selected {
            background-color: #3b82f6; /* blue-500 for better visibility */
            color: #ffffff;
        }
        .dark #entry-tags-container .tag.selected {
            background-color: #16a34a; /* green-600 */
        }
        .dark #psychology-tags-container .tag.selected {
            background-color: #9333ea; /* purple-600 */
        }
        .dark .border-blue-200 { border-color: #1d4ed8; } /* blue-700 */
        .dark .border-green-200 { border-color: #15803d; } /* green-700 */
        .dark .border-purple-200 { border-color: #7e22ce; } /* purple-700 */
        .dark .bg-blue-50 {
            background-color: #27272a; /* zinc-800 */
            border-color: #3f3f46;   /* zinc-700 */
        }
        .dark .text-blue-800 {
             color: #d4d4d8; /* zinc-300 */
        }
        .dark .bg-gray-200 { background-color: #3f3f46; } /* zinc-700 */
        .dark .text-gray-700 { color: #e4e4e7; } /* zinc-200 */
        .dark .text-gray-600 { color: #d4d4d8; } /* zinc-300 */
        .dark .text-gray-800 { color: #f4f4f5; } /* zinc-100 */
        .dark .bg-green-100 { background-color: rgba(34, 197, 94, 0.1); }
        .dark .text-green-800 { color: #4ade80; } /* green-400 */
        .dark .bg-purple-100 { background-color: rgba(168, 85, 247, 0.1); }
        .dark .text-purple-800 { color: #c084fc; } /* purple-400 */
        .dark .border-gray-200 { border-color: #3f3f46; } /* zinc-700 */
        .dark .bg-gray-50 { background-color: #27272a; } /* zinc-800 */
        .dark .hover\:bg-gray-100:hover { background-color: #27272a; } /* zinc-800 */
        .dark .bg-gray-300 { background-color: #52525b; } /* zinc-600 */
        .dark .hover\:bg-gray-400:hover { background-color: #71717a; } /* zinc-500 */
        /* --- END DARK MODE STYLES --- */
    </style>
    <!-- 다크모드 FOUC 방지 및 즉시 적용 스크립트 -->
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>
<body class="bg-gray-100">

    <div id="login-view" class="flex flex-col items-center justify-center min-h-screen p-4">
        <div class="text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">나의 매매일지 & 가계부 📝</h1>
            <p class="text-lg md:text-xl text-gray-500 mb-8">당신의 모든 거래와 지출을 기록하고 성장하세요!</p>
            <button id="login-btn" class="bg-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center">
                <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48"><defs><path id="a" d="M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z"/></defs><clipPath id="b"><use xlink:href="#a" overflow="visible"/></clipPath><path clip-path="url(#b)" fill="#FBBC05" d="M0 37V11l17 13z"/><path clip-path="url(#b)" fill="#EA4335" d="M0 11l17 13 7-6.1L48 14V0H0z"/><path clip-path="url(#b)" fill="#34A853" d="M0 37l30-23 7.9 1L48 0v48H0z"/><path clip-path="url(#b)" fill="#4285F4" d="M48 48L17 24l-4-3 35-10z"/></svg>
                Google 계정으로 로그인
            </button>
        </div>
    </div>

    <div id="app-container" class="max-w-7xl mx-auto p-4 md:p-8 hidden">
        
        <header class="mb-8 relative flex items-center justify-center">
            <div class="text-center px-16 sm:px-20">
                <h1 class="text-3xl md:text-4xl font-bold text-center mb-2">나의 매매일지 & 가계부 📝</h1>
                <p class="text-center text-gray-500">당신의 모든 거래와 지출을 기록하고 성장하세요!</p>
                <div id="auth-info" class="text-center text-xs mt-2"></div>
            </div>
            <div class="absolute top-0 right-0 flex items-center h-full space-x-2">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <i id="sun-icon" data-lucide="sun" class="h-6 w-6"></i>
                    <i id="moon-icon" data-lucide="moon" class="h-6 w-6"></i>
                </button>
                <button id="logout-btn" title="로그아웃" class="text-sm font-semibold hover:text-red-500 transition-colors p-2 rounded-md hover:bg-gray-200">
                    <i data-lucide="log-out" class="h-5 w-5"></i>
                </button>
            </div>
        </header>

        <nav class="flex justify-center bg-white rounded-xl shadow-md p-2 mb-8 space-x-1 sm:space-x-2">
            <button data-tab="form-view" class="tab-btn text-gray-600 active w-full md:w-auto px-2 sm:px-4 md:px-6 py-3 rounded-lg text-xs sm:text-sm md:text-base"><i data-lucide="plus-circle" class="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-1 md:mr-2"></i>일지 작성</button>
            <button data-tab="list-view" class="tab-btn text-gray-600 w-full md:w-auto px-2 sm:px-4 md:px-6 py-3 rounded-lg text-xs sm:text-sm md:text-base"><i data-lucide="book-open" class="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-1 md:mr-2"></i>내 일지</button>
            <button data-tab="stats-view" class="tab-btn text-gray-600 w-full md:w-auto px-2 sm:px-4 md:px-6 py-3 rounded-lg text-xs sm:text-sm md:text-base"><i data-lucide="bar-chart-2" class="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-1 md:mr-2"></i>성과 분석</button>
            <button data-tab="household-view" class="tab-btn text-gray-600 w-full md:w-auto px-2 sm:px-4 md:px-6 py-3 rounded-lg text-xs sm:text-sm md:text-base"><i data-lucide="wallet" class="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-1 md:mr-2"></i>가계부</button>
        </nav>

        <main>
             <div id="form-view">
                <form id="journal-form" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg space-y-8">
                    <input type="hidden" id="journal-id">
                    
                    <div>
                        <h2 class="text-2xl font-bold mb-4 border-b-2 border-blue-200 pb-2 flex items-center"><i data-lucide="clipboard-list" class="mr-3 text-blue-500"></i>기본 정보</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div class="sm:col-span-2"><label for="ticker" class="block text-sm font-medium text-gray-700 mb-1">종목 이름</label><input type="text" id="ticker" placeholder="예: 삼성전자, BTCUSDT" required class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-gray-400 text-gray-800"></div>
                            <div><label for="date" class="block text-sm font-medium text-gray-700 mb-1">날짜</label><input type="date" id="date" required class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800"></div>
                            <div><span class="block text-sm font-medium text-gray-700 mb-2">포지션</span><div class="toggle-group text-gray-600" data-group="position"><button type="button" data-value="long" class="toggle-btn">🟢 롱</button><button type="button" data-value="short" class="toggle-btn">🔴 숏</button></div></div>
                            <div class="sm:col-span-2"><span class="block text-sm font-medium text-gray-700 mb-2">매매 전략</span><div class="toggle-group text-gray-600" data-group="strategy"><button type="button" data-value="단타" class="toggle-btn">단타</button><button type="button" data-value="스윙" class="toggle-btn">스윙</button><button type="button" data-value="장기" class="toggle-btn">장기</button></div></div>
                            <div class="sm:col-span-2"><span class="block text-sm font-medium text-gray-700 mb-2">입력 통화</span><div class="toggle-group text-gray-600 w-full" data-group="form-currency"><button type="button" id="form-currency-krw-btn" class="toggle-btn selected">원 (₩)</button><button type="button" id="form-currency-usd-btn" class="toggle-btn">달러 ($)</button></div></div>
                            <div><label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">수량</label><input type="text" inputmode="numeric" id="quantity" placeholder="예: 100" required class="number-input w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-gray-400 text-gray-800"></div>
                            <div><label for="entry-price" class="block text-sm font-medium text-gray-700 mb-1">매입가</label><input type="text" inputmode="decimal" id="entry-price" placeholder="예: 10,000" required class="number-input w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-gray-400 text-gray-800"></div>
                            <div><label for="stop-loss" class="block text-sm font-medium text-gray-700 mb-1">손절가</label><input type="text" inputmode="decimal" id="stop-loss" placeholder="예: 9,500" required class="number-input w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-gray-400 text-gray-800"></div>
                            <div><label for="target-price" class="block text-sm font-medium text-gray-700 mb-1">목표가</label><input type="text" inputmode="decimal" id="target-price" placeholder="예: 11,000" required class="number-input w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-gray-400 text-gray-800"></div>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-2xl font-bold mb-4 border-b-2 border-green-200 pb-2 flex items-center"><i data-lucide="siren" class="mr-3 text-green-500"></i>진입 근거</h2>
                        <div id="entry-tags-container" class="flex flex-wrap gap-2 mb-2"></div>
                        <div class="flex flex-col sm:flex-row gap-2"><input type="text" id="new-entry-tag" placeholder="새로운 태그 추가 (예: 정배열 돌파)" class="flex-grow p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-green-400 focus:border-transparent placeholder-gray-400 text-gray-800"><button type="button" id="add-entry-tag-btn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">추가</button></div>
                    </div>

                    <div>
                        <h2 class="text-2xl font-bold mb-4 border-b-2 border-purple-200 pb-2 flex items-center"><i data-lucide="brain-circuit" class="mr-3 text-purple-500"></i>심리 상태</h2>
                        <div id="psychology-tags-container" class="flex flex-wrap gap-2 mb-2"></div>
                        <div class="flex flex-col sm:flex-row gap-2"><input type="text" id="new-psychology-tag" placeholder="새로운 태그 추가 (예: FOMO)" class="flex-grow p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-purple-400 focus:border-transparent placeholder-gray-400 text-gray-800"><button type="button" id="add-psychology-tag-btn" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition">추가</button></div>
                    </div>
                    
                    <div class="flex justify-end space-x-4"><button type="button" id="clear-form-btn" class="bg-gray-400 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-500 transition">새로 작성</button><button type="submit" class="bg-blue-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-600 transition"><i data-lucide="save" class="inline-block w-5 h-5 mr-2"></i>일지 저장</button></div>
                </form>
            </div>
            <div id="list-view" class="hidden">
                 <div class="bg-white p-4 rounded-2xl shadow-lg mb-6 flex flex-wrap items-center justify-center gap-x-6 gap-y-4">
                     <div class="flex items-center space-x-2">
                        <label for="list-exchange-rate" class="font-medium text-sm text-gray-600">환율 (USD/KRW):</label>
                        <input type="text" inputmode="numeric" id="list-exchange-rate" value="1,380" class="exchange-rate-input number-input w-28 p-2 border border-gray-300 bg-white rounded-lg text-center text-gray-800">
                    </div>
                </div>
                <div class="bg-blue-50 border border-blue-200 text-blue-800 text-sm p-4 rounded-xl mb-6 flex items-center gap-3">
                    <i data-lucide="info" class="w-5 h-5 flex-shrink-0"></i>
                    <p>각 일지 우측 상단의 <i data-lucide="log-out" class="inline-block w-4 h-4 mx-1"></i>(청산), <i data-lucide="edit" class="inline-block w-4 h-4 mx-1"></i>(수정), <i data-lucide="trash-2" class="inline-block w-4 h-4 mx-1"></i>(삭제) 아이콘을 눌러 관리할 수 있습니다.</p>
                </div>
                <div id="journal-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </div>
            <div id="stats-view" class="hidden space-y-8">
                 <div class="bg-white p-4 rounded-2xl shadow-lg mb-6 flex flex-col sm:flex-row items-center justify-center gap-x-6 gap-y-4">
                    <div class="flex items-center space-x-2">
                        <label for="stats-exchange-rate" class="font-medium text-sm text-gray-600">환율 (USD/KRW):</label>
                        <input type="text" inputmode="numeric" id="stats-exchange-rate" value="1,380" class="exchange-rate-input number-input w-28 p-2 border border-gray-300 bg-white rounded-lg text-center text-gray-800">
                    </div>
                    <div class="toggle-group text-gray-600 w-full sm:w-auto" data-group="stats-currency">
                        <button id="stats-currency-krw-btn" class="toggle-btn selected">원 (₩)</button>
                        <button id="stats-currency-usd-btn" class="toggle-btn">달러 ($)</button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-lg lg:col-span-1"><h3 class="text-xl font-bold mb-4">총 손익 구성</h3><div class="chart-container"><canvas id="pnl-composition-chart"></canvas></div></div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg lg:col-span-2"><h3 class="text-xl font-bold mb-4">월별 손익 추세</h3><div class="chart-container"><canvas id="monthly-pnl-chart"></canvas></div><div id="monthly-pnl-summary" class="mt-4 text-sm text-center"></div></div>
                </div>
                <div class="grid grid-cols-1">
                    <div class="bg-white p-6 rounded-2xl shadow-lg"><h3 class="text-xl font-bold mb-4">분기별 손익 추세</h3><div class="chart-container"><canvas id="quarterly-pnl-chart"></canvas></div><div id="quarterly-pnl-summary" class="mt-4 text-sm text-center"></div></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                     <div class="bg-white p-6 rounded-2xl shadow-lg"><h3 class="text-xl font-bold mb-4">진입 근거별 승률</h3><div class="chart-container"><canvas id="entry-win-rate-chart"></canvas></div></div>
                     <div class="bg-white p-6 rounded-2xl shadow-lg"><h3 class="text-xl font-bold mb-4">심리 상태별 승률</h3><div class="chart-container"><canvas id="psychology-win-rate-chart"></canvas></div></div>
                     <div class="bg-white p-6 rounded-2xl shadow-lg"><h3 class="text-xl font-bold mb-4">매매 전략별 승률</h3><div class="chart-container"><canvas id="strategy-win-rate-chart"></canvas></div></div>
                </div>
                <div class="grid grid-cols-1">
                    <div class="bg-white p-6 rounded-2xl shadow-lg"><h3 class="text-xl font-bold mb-4">롱/숏 포지션 승률</h3><div class="chart-container"><canvas id="position-win-rate-chart"></canvas></div></div>
                </div>
            </div>

            <!-- 가계부 뷰 -->
            <div id="household-view" class="hidden space-y-8">
                <!-- 가계부 입력 폼 -->
                <form id="household-form" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg space-y-8">
                    <input type="hidden" id="household-id">
                    <h2 class="text-2xl font-bold flex items-center"><i data-lucide="wallet-cards" class="mr-3 text-blue-500"></i>가계부 기록</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <div>
                            <span class="block text-sm font-medium text-gray-700 mb-2">유형</span>
                            <div class="toggle-group text-gray-600" data-group="household-type">
                                <button type="button" data-value="expense" class="toggle-btn selected">🔴 지출</button>
                                <button type="button" data-value="income" class="toggle-btn">🟢 수입</button>
                            </div>
                        </div>
                        <div><label for="household-date" class="block text-sm font-medium text-gray-700 mb-1">날짜</label><input type="date" id="household-date" required class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800"></div>
                        <div class="sm:col-span-2"><label for="household-memo" class="block text-sm font-medium text-gray-700 mb-1">내용</label><input type="text" id="household-memo" placeholder="예: 스타벅스 아이스 아메리카노" required class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-gray-400 text-gray-800"></div>
                        <div id="category-section">
                            <label for="household-category" class="block text-sm font-medium text-gray-700 mb-1">카테고리</label>
                            <div class="flex gap-2">
                                <select id="household-category" class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800"></select>
                                <button type="button" id="manage-category-btn" class="p-2 bg-gray-200 rounded-lg hover:bg-gray-300"><i data-lucide="settings-2" class="w-5 h-5"></i></button>
                            </div>
                        </div>
                        <div><label for="household-amount" class="block text-sm font-medium text-gray-700 mb-1">금액 (₩)</label><input type="text" inputmode="numeric" id="household-amount" required class="number-input w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-gray-400 text-gray-800"></div>
                    </div>
                     <div class="flex justify-end"><button type="submit" class="bg-blue-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-600 transition"><i data-lucide="save" class="inline-block w-5 h-5 mr-2"></i>기록 저장</button></div>
                </form>

                <!-- 가계부 통계 및 내역 -->
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg space-y-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                        <h2 class="text-2xl font-bold flex items-center"><i data-lucide="calendar-days" class="mr-3 text-blue-500"></i>기간별 내역 조회</h2>
                         <div class="toggle-group text-gray-600 w-full sm:w-auto" data-group="household-period">
                            <button type="button" data-value="monthly" class="toggle-btn selected">월별</button>
                            <button type="button" data-value="quarterly" class="toggle-btn">분기별</button>
                            <button type="button" data-value="yearly" class="toggle-btn">연도별</button>
                        </div>
                        <input type="month" id="household-month-picker" class="p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800">
                    </div>
                    
                    <!-- 요약 -->
                    <div id="household-summary" class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                        <div><p class="text-sm text-gray-500">총 수입</p><p id="summary-income" class="text-2xl font-bold text-green-500">₩0</p></div>
                        <div><p class="text-sm text-gray-500">총 지출</p><p id="summary-expense" class="text-2xl font-bold text-red-500">₩0</p></div>
                        <div><p class="text-sm text-gray-500">순손익</p><p id="summary-net" class="text-2xl font-bold">₩0</p></div>
                    </div>

                    <!-- 차트 -->
                    <div class="chart-container"><canvas id="expense-category-chart"></canvas></div>

                    <!-- 상세 내역 -->
                    <div id="household-list" class="space-y-2"></div>
                </div>

            </div>
            
            <!-- 카테고리 관리 모달 -->
            <div id="category-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop opacity-0">
                <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md modal-content transform scale-95">
                    <h2 class="text-2xl font-bold mb-6">카테고리 관리</h2>
                    <div id="category-list" class="space-y-2 mb-4 max-h-60 overflow-y-auto"></div>
                    <div class="flex gap-2"><input type="text" id="new-category-name" placeholder="새 카테고리 이름" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400"><button type="button" id="add-category-btn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">추가</button></div>
                    <div class="mt-8 flex justify-end"><button type="button" id="close-category-modal-btn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400">닫기</button></div>
                </div>
            </div>

        </main>
    </div>

    <!-- ... (기존 모달들은 여기에 위치) ... -->
    <div id="exit-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop opacity-0">
        <!-- ... (기존 코드와 동일) ... -->
    </div>
    <div id="confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop opacity-0">
         <!-- ... (기존 코드와 동일) ... -->
    </div>
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300"><p id="toast-message"></p></div>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    
    <script>
        // 이 스크립트 블록은 Firebase 및 모든 앱 로직을 포함합니다.
        // 이전에 발생한 중복 선언 오류를 해결하기 위해 스크립트 내용을 여기에 통합했습니다.
    </script>
</body>
</html>

